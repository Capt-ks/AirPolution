<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Data from PurpleAir Sensor 130815 - Fajardo Area, PR</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto; }
        .value { font-size: 2em; font-weight: bold; color: #333; }
        .aqi-good { color: green; }
        .aqi-moderate { color: orange; }
        .aqi-unhealthy { color: red; }
        #refreshBtn { padding: 10px 20px; font-size: 1em; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Current Air Quality - PurpleAir Sensor 130815</h2>
        <p id="sensorName">Loading sensor info...</p>
        <p id="location"></p>
        <p id="lastUpdate"></p>
        
        <div id="pm25Section">
            <strong>PM2.5 (µg/m³):</strong> <span id="pm25Value" class="value">-</span>
            <span id="aqiLevel"></span>
        </div>
        
        <p>Temperature: <span id="temp">-</span> °F | Humidity: <span id="humidity">-</span>% | Pressure: <span id="pressure">-</span> hPa</p>
        
        <button id="refreshBtn">Refresh Data</button>
        <div id="status"></div>
    </div>

    <script>
        const apiKey = 'YOUR_API_KEY_HERE'; // Replace with your PurpleAir READ API key
        const sensorIndex = 130815;

        const statusDiv = document.getElementById('status');
        const refreshBtn = document.getElementById('refreshBtn');

        function loadCurrentData() {
            statusDiv.innerHTML = '<p>Loading current data...</p>';

            // Fetch single sensor current data
            fetch(`https://api.purpleair.com/v1/sensors/${sensorIndex}?fields=name,latitude,longitude,altitude,pm2.5_atm,temperature,humidity,pressure,last_seen,location_type`, {
                headers: { 'X-API-Key': apiKey }
            })
            .then(res => {
                if (!res.ok) throw new Error('Cannot access sensor (check API key, sensor index, or if sensor is public)');
                return res.json();
            })
            .then(data => {
                const s = data.sensor;

                document.getElementById('sensorName').textContent = `Sensor: ${s.name || 'Unnamed'} (Index: ${sensorIndex})`;
                document.getElementById('location').textContent = `Location: ${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)} ${s.location_type === 0 ? '(Outdoor)' : '(Indoor)'}`;
                
                const lastSeen = new Date(s.last_seen * 1000);
                document.getElementById('lastUpdate').textContent = `Last updated: ${lastSeen.toLocaleString()}`;

                const pm25 = parseFloat(s['pm2.5_atm']) || 0;
                document.getElementById('pm25Value').textContent = pm25.toFixed(1);

                // Simple AQI color indication for PM2.5
                let aqiClass = 'aqi-good';
                let aqiText = ' (Good)';
                if (pm25 > 50) { aqiClass = 'aqi-unhealthy'; aqiText = ' (Unhealthy)'; }
                else if (pm25 > 12) { aqiClass = 'aqi-moderate'; aqiText = ' (Moderate)'; }
                document.getElementById('aqiLevel').textContent = aqiText;
                document.getElementById('aqiLevel').className = aqiClass;

                document.getElementById('temp').textContent = s.temperature !== undefined ? s.temperature.toFixed(1) : 'N/A';
                document.getElementById('humidity').textContent = s.humidity !== undefined ? s.humidity.toFixed(0) : 'N/A';
                document.getElementById('pressure').textContent = s.pressure !== undefined ? s.pressure.toFixed(1) : 'N/A';

                statusDiv.innerHTML = '<p style="color:green;">Current data loaded successfully!</p>';
            })
            .catch(error => {
                statusDiv.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
                statusDiv.innerHTML += '<p>If the sensor is new or offline, current values may be unavailable. Try refreshing later.</p>';
                console.error(error);
            });
        }

        // Load on page open
        loadCurrentData();

        // Refresh button
        refreshBtn.onclick = loadCurrentData;
    </script>

    <p><strong>Notes:</strong></p>
    <ul>
        <li>This displays the <strong>current (real-time) readings</strong> from sensor 130815 only – no historical graph.</li>
        <li>Data updates every ~2 minutes on PurpleAir servers.</li>
        <li>If you see an error or no values, the sensor may be offline, private, or not yet reporting.</li>
        <li>Click "Refresh Data" to update manually.</li>
    </ul>
</body>
</html>
